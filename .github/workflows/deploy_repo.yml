name: Install into repository

on: 
  workflow_dispatch:
    inputs:
      environment: 
        decsription: 'prod or dev'
        required: true
        default: 'dev'

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0
    - name: Set up JDK 14
      uses: actions/setup-java@v1
      with:
        java-version: 14
    - name: Build with Maven
      run: mvn -B package --file pom.xml
    - name: install jar
      run: |
        if [ ${{github.event.inputs.environment}} == dev ]
        then
        mvn install:install-file -Dversion=dev -DpomFile=pom.xml -Dfile=./target/Ultimate_Economy-API.jar -Dpackaging=jar -DgeneratePom=true -DlocalRepositoryPath=.  -DcreateChecksum=true;
        elif [ ${{github.event.inputs.environment}} == prod ]
        then
        mvn install:install-file -DpomFile=pom.xml -Dfile=./target/Ultimate_Economy-API.jar -Dpackaging=jar -DgeneratePom=true -DlocalRepositoryPath=.  -DcreateChecksum=true;
        fi
    - name: deploy
      run: |  
        git config --global user.email "github-actions@users.noreply.github.com"
        git config --global user.name "github-actions"

        git add --all
        git commit -m 'Deploy new API version'
        git stash
        git checkout repository
        git stash pop
      
        git push
        

